rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check for admin role based on email.
    function isAdmin() {
      // The admin role is determined solely by the user's email.
      return request.auth.token.email == 'admin@8bit.com';
    }

    // --- Security Rules for Collections ---

    // Admins Collection:
    // This collection is no longer used for authorization.
    // Rules are set to deny all access to prevent accidental usage.
    match /admins/{userId} {
      allow read, write: if false;
    }
    
    // Players Collection:
    // - Any authenticated user can create a player (e.g., at the tournament desk).
    // - Only admins can read the full list of players, or update/delete individual players.
    match /players/{playerId} {
      allow create: if request.auth != null;
      allow read, update, delete: if isAdmin();
    }

    // Games Collection:
    // - Any authenticated user can read the list of games (e.g., for the score submission form).
    // - Only admins can create, update, or delete games.
    match /games/{gameId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
    
    // Events Collection:
    // - Any authenticated user can read the list of events.
    // - Only admins can create, update, or delete them.
    match /events/{eventId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Score Submissions Collection:
    // - Any authenticated user can create a score submission and read all scores (for the public leaderboard).
    // - Only admins can update or delete scores (for moderation).
    match /scoreSubmissions/{scoreSubmissionId} {
      allow read, create: if request.auth != null;
      allow update, delete: if isAdmin();
    }
  }
}
