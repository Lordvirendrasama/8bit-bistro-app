rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Helper function to check for admin role by seeing if a document
    // exists for the user's UID in the 'admins' collection.
    function isAdmin() {
      return exists(/databases/$(database)/documents/admins/$(request.auth.uid));
    }

    // --- Security Rules for Collections ---

    // Admins Collection:
    // - Only other admins can create/update/delete admin documents.
    // - An authenticated user is allowed to check their own admin status.
    match /admins/{userId} {
      allow read: if request.auth.uid == userId;
      allow write: if isAdmin();
    }
    
    // Players Collection:
    // - Any authenticated user can create a player (e.g., at the tournament desk).
    // - Only admins can read the full list of players, or update/delete individual players.
    match /players/{playerId} {
      allow create: if request.auth != null;
      allow read, update, delete: if isAdmin();
    }

    // Games Collection:
    // - Any authenticated user can read the list of games (e.g., for the score submission form).
    // - Only admins can create, update, or delete games.
    match /games/{gameId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }
    
    // Events Collection:
    // - Any authenticated user can read the list of events.
    // - Only admins can create, update, or delete them.
    match /events/{eventId} {
      allow read: if request.auth != null;
      allow write: if isAdmin();
    }

    // Score Submissions Collection:
    // - Any authenticated user can create a score submission and read all scores (for the public leaderboard).
    // - Only admins can update or delete scores (for moderation).
    match /scoreSubmissions/{scoreSubmissionId} {
      allow read, create: if request.auth != null;
      allow update, delete: if isAdmin();
    }
  }
}
